{% extends 'home.html.twig' %}

{% block admin_home_navigation_items %}

    {{ style({ include: oViewConf.getModuleUrl('eyeable_assist', 'css/eyeableassist.css') }) }}
    <div>

        <p>{{ translate({ ident: "EYEABLE_REPORT_TITLE" }) }}</p>
        <p>{{ translate({ ident: "EYEABLE_REPORT_EXPLANATION" }) }}</p>

        {% set eyeablereport = oViewConf.getLatestEyeableReportData() %}

        {% if eyeablereport and eyeablereport.getErrorCount() >= 0 %}
            <p>{{ translate({ ident: "EYEABLE_LATEST_REPORT_PAGE" }) }}{{ eyeablereport.getTestedPage() }}</p>
            <p>{{ translate({ ident: "EYEABLE_LATEST_REPORT_ERRORCOUNT" }) }}{{ eyeablereport.getErrorCount() }}</p>
            <p>{{ translate({ ident: "EYEABLE_LATEST_REPORT_DATE" }) }}{{ eyeablereport.getReportDate() }}</p>
        {% else %}
            <p>{{ translate({ ident: "EYEABLE_PLEASE_WAIT_FOR_REPORT" }) }}</p>
        {% endif %}
    </div>

    <script>
        window.addEventListener(
            'DOMContentLoaded',
            function () {
                let widgetUrl = '{{ oViewConf.getShopURL() }}' + '/admin/index.php?cl=eyeabletrigger&fnc=triggerEyeableReport';

                const xhttp = new XMLHttpRequest();
                xhttp.timeout = 1000;
                xhttp.open('GET', widgetUrl, true);
                xhttp.ontimeout = (e) => {
                    // XMLHttpRequest timed out. We did not want a response anway
                };
                xhttp.send();
            }
        );
    </script>

    {{ parent() }}
{% endblock %}